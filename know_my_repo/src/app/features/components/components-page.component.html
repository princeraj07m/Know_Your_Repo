<div class="components-page">
  <h1 class="components-title">Components</h1>

  @if (!hasData()) {
    <app-empty-state
      icon="fa-cubes"
      title="Components view"
      message="Analyze a codebase to explore its components and modules."
      actionLabel="Upload codebase"
      actionRoute="/upload"
    />
  } @else {
    <section class="mb-4" [@fadeInUp]>
      <app-animated-card padding="lg" [hoverable]="true">
        <h2 class="section-heading mb-3">
          <i class="fas fa-cubes text-accent"></i>
          Core components
        </h2>
        @if (coreComponents().length > 0) {
          <div class="component-grid">
            @for (c of coreComponents(); track c) {
              <div class="component-chip">
                <div class="component-chip-icon">
                  <i class="fas fa-cube"></i>
                </div>
                <div class="component-chip-body">
                  <span class="component-chip-name">{{ c }}</span>
                </div>
              </div>
            }
          </div>
        } @else {
          <p class="text-secondary small mb-0">No components detected.</p>
        }
      </app-animated-card>
    </section>

    @if (routeTraces().length > 0) {
      <section class="route-traces-section" [@fadeInUp]>
        <app-animated-card padding="lg" [hoverable]="true">
          <h2 class="section-heading mb-3">
            <i class="fas fa-route text-accent"></i>
            Interactive trace
          </h2>
          <p class="text-secondary small mb-3">Click a route to see controller, service, and model.</p>
          <ul class="trace-route-list list-unstyled mb-0">
            @for (trace of routeTraces(); track trace.route) {
              <li class="trace-route-item">
                <button
                  type="button"
                  class="trace-route-btn"
                  [class.trace-route-btn--active]="expandedRoute() === trace.route"
                  (click)="toggleTrace(trace)"
                >
                  <i class="fas fa-chevron-right me-2 chevron" [class.chevron--open]="expandedRoute() === trace.route"></i>
                  {{ trace.route }}
                </button>
                @if (expandedRoute() === trace.route) {
                  <div class="trace-inline-details">
                    @if (trace.controller) {
                      <div class="trace-inline-row">
                        <span class="trace-inline-pill trace-inline-pill--controller">
                          <i class="fas fa-code"></i>
                          Controller
                        </span>
                        <span class="trace-inline-value">{{ trace.controller }}</span>
                      </div>
                    }
                    @if (trace.service) {
                      <div class="trace-inline-row">
                        <span class="trace-inline-pill trace-inline-pill--service">
                          <i class="fas fa-cog"></i>
                          Service
                        </span>
                        <span class="trace-inline-value">{{ trace.service }}</span>
                      </div>
                    }
                    @if (trace.model) {
                      <div class="trace-inline-row">
                        <span class="trace-inline-pill trace-inline-pill--model">
                          <i class="fas fa-database"></i>
                          Model
                        </span>
                        <span class="trace-inline-value">{{ trace.model }}</span>
                      </div>
                    }
                  </div>
                }
              </li>
            }
          </ul>
        </app-animated-card>
      </section>
    }
  }
</div>
